<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 405 Term Project: Software Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME 405 Term Project<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Self panning and shooting turret with target tracking executed with a thermal camera.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Software Overview </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>This main page covers the workings of the <a class="el" href="main_8py.html" title="This is the main file for the term project.">main.py</a> file used for this project, as well as the files that were used to make the whole system work.</p>
<h1><a class="anchor" id="file_sec"></a>
Files</h1>
<p>This is an overview of the files that we wrote and utilized:</p>
<h2><a class="anchor" id="controller_sec"></a>
controller.py</h2>
<p>This file is used as a high-level proportional controller for our motors. We use it to control the desired position of our motors, and also to interface with some of the lower-level files, seen below.</p>
<h2><a class="anchor" id="csv_sec"></a>
csv_reader.py</h2>
<p>This file was originally used for a plotter, but for the purposes of this project we adapted it to read the output of the thermal camera. We wrote a method in the class that reads the camera data, and then calculates the hottest thermal column, which is what we used to pick an aiming point.</p>
<h2><a class="anchor" id="encoder_sec"></a>
encoder_reader.py</h2>
<p>This file is a fairly self-explanatory class. We use it to read from the encoders and handle all the calculations related to determining the position of the motors. This file is referenced by the controller to read the motor positions.</p>
<h2><a class="anchor" id="mlx_sec"></a>
mlx_cam.py</h2>
<p>This is a file that was provided to us to read the infrared camera output. It was utilized in Task 2 of our main file.</p>
<h2><a class="anchor" id="motor_sec"></a>
motor_driver.py</h2>
<p>This file is used to control the speed of the motors. It takes a desired pwm output and feeds it to the motor driver. This file is also referenced by the controller, which uses this file and the encoder reader to create an effective proportional controller.</p>
<h1><a class="anchor" id="task_sec"></a>
Tasks</h1>
<p>IMAGE_PATH = my_image_dir</p>
<div class="image">
<img src="taskdiag.png" alt=""/>
</div>
<p>The following are the tasks and states used in the main file of this project:</p>
<h2><a class="anchor" id="t1_sec"></a>
Task 1</h2>
<div class="image">
<img src="t1statediag.png" alt=""/>
</div>
<p>Task 1 runs the panning motion for motor #1. This task first moves the turret into the aiming position (180 degrees from initial position). Then, updates the panning motor setpoint calculated by the thermal camera and runs until the PWM signal falls below 50% for more than 20 cycles and sets the panning motor duty cycle to 0 and waits for the trigger motor to complete its task. These are the states that are utilized in Task 1:</p>
<h3><a class="anchor" id="t1s0_sec"></a>
State 0</h3>
<p>This state is an initialization state for the panning motor that sets up the enable, pwm, and encoder pins, as well as establishing the controller class instance for the pan.</p>
<h3><a class="anchor" id="t1s1_sec"></a>
State 1</h3>
<p>This state is used to capture an image. Once that is completed, we move to state 2.</p>
<h3><a class="anchor" id="t1s2_sec"></a>
State 2</h3>
<p>This state is used when the turret is panning to track the target. In this current implementation of our code, we are not actively tracking a target, we are instead waiting for the 5 seconds and then turning towards the target and firing. If we wanted to implement active tracking in the future, this state is ready for that, with a few modifications.</p>
<h3><a class="anchor" id="t1s3_sec"></a>
State 3</h3>
<p>This state is an idle for the panning motor. This is used both when we are tracking the duel target, and when we are waiting for our turret to fire</p>
<h2><a class="anchor" id="t2_sec"></a>
Task 2</h2>
<div class="image">
<img src="t2statediag.png" alt=""/>
</div>
<p>Task 2 deals with the thermal camera. It initializes the camera's i2c communication protocal them waits until the panning motor completes its initial movement to the aiming position 180 degrees from the initial postion. Then wait 3.25 seconds and get the image. Then, using the csv_reader class, calculate the column with the maximum summed thermal signature and calculate the setpoint based on the column. These are the states that are utilized in Task 1:</p>
<h3><a class="anchor" id="t2s0_sec"></a>
State 0</h3>
<p>This state is an initialization state for the camera that intitializes the mlx_cam class instance, as well as setting the refresh rate of the camera.</p>
<h3><a class="anchor" id="t2s1_sec"></a>
State 1</h3>
<p>This state is used to spin the whole turret 180 degrees at the start of the duel. Once it has turned, it switches to state 3.</p>
<h3><a class="anchor" id="t2s2_sec"></a>
State 2</h3>
<p>This state utilizes the csv reader to interpret the data that was captured by the camera in state 1. This gives us a column from the data that we need to aim at. This moves us to state 3.</p>
<h3><a class="anchor" id="t2s3_sec"></a>
State 3</h3>
<p>This state takes the data that we got from the csv reader and uses trigonometry and information about our camera and setup geometry to calculate the angle that our turret needs to turn to correctly aim at the target, and then it uses a shared variable to pass that information to Task 1 and 3.</p>
<h3><a class="anchor" id="t2s4_sec"></a>
State 4</h3>
<p>This state waits for the turret to fire and does not take any images that may cause lag.</p>
<h3><a class="anchor" id="t2s5_sec"></a>
State 5</h3>
<p>This state waits for the panning motor to spin 180 degrees at the start of the duel before taking any images.</p>
<h2><a class="anchor" id="t3_sec"></a>
Task 3</h2>
<div class="image">
<img src="t3statediag.png" alt=""/>
</div>
<p>Task 3 runs the trigger motion for the motor #2. First, task 3 waits until the panning motor reaches the setpoint calculated by the thermal camera. Then, it runs the trigger motor to a setpoint of 30 degrees, then returns to its intial position. The states it uses are below:</p>
<h3><a class="anchor" id="t3s0_sec"></a>
State 0</h3>
<p>This state is an initialization state for the trigger motor that sets up the enable, pwm, and encoder pins, as well as establishing the controller class instance for the trigger.</p>
<h3><a class="anchor" id="t3s1_sec"></a>
State 1</h3>
<p>This state is used to wait until the turret is ready to fire</p>
<h3><a class="anchor" id="t3s2_sec"></a>
State 2</h3>
<p>This state is used when the turret is firing. This activates the trigger motor to pull until it reaches the desired setpoint that we tested to guarantee that the turret fires.</p>
<h3><a class="anchor" id="t3s3_sec"></a>
State 3</h3>
<p>This state returns the trigger mechanism to its zero location after firing.</p>
<h2><a class="anchor" id="t4_sec"></a>
Task 4</h2>
<div class="image">
<img src="t4statediag.png" alt=""/>
</div>
<p>Task 4 is a simple task that acts as our safety system. Our design used a safety wire that when pulled, shuts down the whole system. The states used are as follows:</p>
<h3><a class="anchor" id="t4s0_sec"></a>
State 0</h3>
<p>This state simple initializes the variables used for the safety wire.</p>
<h3><a class="anchor" id="t4s1_sec"></a>
State 1</h3>
<p>This state is where the safety task always operates after initialization. It checks that the wire is still connected. If the wire is pulled, then the system is halted and will no longer operate until it is reset and the safety wire is replaced. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"/>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
